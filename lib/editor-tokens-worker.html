<html>
  <script type="text/javascript">
    const remote = require('electron').remote
    const ipc = require('electron').ipcRenderer
    const BrowserWindow = require('electron').remote.BrowserWindow

    const firstMate = require('first-mate');
    const GrammarRegistry = require('first-mate').GrammarRegistry;
    const registry = new GrammarRegistry();

    let grammar;
    ipc.on('grammar-path', (event, path) => {
      grammar = registry.loadGrammarSync(path);
    });

    ipc.on('tokenize', function (event, editorId, editorText, fromWindowId) {
      const fromWindow = BrowserWindow.fromId(fromWindowId);
      const tokens = [];

      if (grammar) {
        Array.prototype.push.apply(tokens, grammar.tokenizeLines(editorText));
      }

      fromWindow.webContents.send('tokens', editorId, tokens);
    });
  </script>
</html>